version: "3.5"

# ======================================================================================================================
# Default network.
networks:
  cassandre:
    name: cassandre

# ======================================================================================================================
# Volumes - Volumes are the preferred mechanism for persisting data generated by and used by Docker containers.
# You can list them with the command: 'docker volume ls'
# You can see the details with 'docker inspect cassandre-trading-bot-server_database'
volumes:
  database:
  backup:

# ======================================================================================================================
# Services (images).
services:

  # ====================================================================================================================
  # Postgresql - Database used to backup Cassandre trading bot data (trades/positions).
  # https://hub.docker.com/_/postgres
  postgresql:
    image: library/postgres:13-alpine
    restart: always
    networks:
      - cassandre
    volumes:
      - database:/var/lib/postgresql/data
    environment:
      - TZ=Europe/Paris
      - PGTZ=Europe/Paris
      - POSTGRES_DB=cassandre_trading_bot
      - POSTGRES_USER=cassandre_trading_bot
      - POSTGRES_PASSWORD=mypassword

  # ====================================================================================================================
  # Postgresql backup - Util tools to backup the database.
  # https://github.com/prodrigestivill/docker-postgres-backup-local
  postgresql-backup:
    image: prodrigestivill/postgres-backup-local:13-alpine
    depends_on:
      - postgresql
    restart: always
    networks:
      - cassandre
    volumes:
      - backup:/backups
    environment:
      - TZ=Europe/Paris
      - POSTGRES_HOST=postgresql
      - POSTGRES_DB=cassandre_trading_bot
      - POSTGRES_USER=cassandre_trading_bot
      - POSTGRES_PASSWORD=mypassword
      - POSTGRES_EXTRA_OPTS=-Z9
      - SCHEDULE=@every 01h00m00s
      - BACKUP_KEEP_DAYS=7
      - BACKUP_KEEP_WEEKS=4
      - BACKUP_KEEP_MONTHS=0
      - HEALTHCHECK_PORT=8080
