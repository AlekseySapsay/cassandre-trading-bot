<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
                   xmlns:pro="http://www.liquibase.org/xml/ns/pro" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.1.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd">
    <changeSet author="straumat" id="changelog-4.0">

        <!-- ======================================================================================================= -->
        <!-- Positions -->
        <createTable tableName="POSITIONS">
            <column name="ID" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="positions_pkey"/>
            </column>
            <column name="STATUS" type="VARCHAR(255)"/>
            <column name="CURRENCY_PAIR" type="VARCHAR(255)"/>
            <column name="AMOUNT" type="numeric(16, 8)"/>
            <column name="RULES_STOP_GAIN_PERCENTAGE" type="FLOAT"/>
            <column name="RULES_STOP_LOSS_PERCENTAGE" type="FLOAT"/>
            <column name="OPEN_ORDER_ID" type="VARCHAR(255)"/>
            <column name="CLOSE_ORDER_ID" type="VARCHAR(255)"/>
            <column name="HIGHEST_PRICE" type="numeric(16, 8)"/>
            <column name="LOWEST_PRICE" type="numeric(16, 8)"/>
            <column name="LATEST_PRICE" type="numeric(16, 8)"/>
        </createTable>
        <addAutoIncrement columnDataType="BIGINT"
                          columnName="ID"
                          incrementBy="1"
                          startWith="1"
                          tableName="POSITIONS"/>
        <!-- ======================================================================================================= -->

        <!-- ======================================================================================================= -->
        <!-- Orders -->
        <createTable tableName="ORDERS">
            <column name="ID" type="VARCHAR(255)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="orders_pkey"/>
            </column>
            <column name="TYPE" type="VARCHAR(255)"/>
            <column name="ORIGINAL_AMOUNT" type="numeric(16, 8)"/>
            <column name="CURRENCY_PAIR" type="VARCHAR(255)"/>
            <column name="USER_REFERENCE" type="VARCHAR(255)"/>
            <column name="TIMESTAMP" type="TIMESTAMP WITHOUT TIME ZONE"/>
            <column name="STATUS" type="VARCHAR(255)"/>
            <column name="CUMULATIVE_AMOUNT" type="numeric(16, 8)"/>
            <column name="AVERAGE_PRICE" type="numeric(16, 8)"/>
            <column name="FEE" type="numeric(16, 8)"/>
            <column name="LEVERAGE" type="VARCHAR(255)"/>
            <column name="LIMIT_PRICE" type="numeric(16, 8)"/>
        </createTable>
        <!-- ======================================================================================================= -->

        <!-- ======================================================================================================= -->
        <!-- Trades -->
        <createTable tableName="TRADES">
            <column name="ID" type="VARCHAR(255)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="trades_pkey"/>
            </column>
            <column name="ORDER_ID" type="VARCHAR(255)"/>
            <column name="ORDER_TYPE" type="VARCHAR(255)"/>
            <column name="ORIGINAL_AMOUNT" type="numeric(16, 8)"/>
            <column name="CURRENCY_PAIR" type="VARCHAR(255)"/>
            <column name="PRICE" type="numeric(16, 8)"/>
            <column name="TIMESTAMP" type="TIMESTAMP WITHOUT TIME ZONE"/>
            <column name="FEE_AMOUNT" type="numeric(16, 8)"/>
            <column name="FEE_CURRENCY" type="VARCHAR(255)"/>
            <column name="POSITION_ID" type="BIGINT"/>
        </createTable>
        <addForeignKeyConstraint baseColumnNames="position_id" baseTableName="trades"
                                 constraintName="trades_position_id" deferrable="false"
                                 initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="id" referencedTableName="positions"
                                 validate="true"/>
        <!-- ======================================================================================================= -->

    </changeSet>
</databaseChangeLog>